---
- name: Install Powershell modules
  when: not sqlserver_windows
  ansible.builtin.command: >
    pwsh -Command "{{ item }}"
  loop:
    - "{{ dbops_install_cmd }}"
    - "{{ dbatools_install_cmd }}"
    - "{{ bypass_cmd}}"
- name: Apply SystemPolicy fix for Linux
  ansible.builtin.shell: |
    pwsh -Command "
    if (-not ('SystemPolicy' -as [Type])) {
      Add-Type -TypeDefinition 'public class SystemPolicy { public static bool IsCodeExecutionAllowed() { return true; } }' -ErrorAction SilentlyContinue
    }
    "
  when: ansible_system == 'Linux'
